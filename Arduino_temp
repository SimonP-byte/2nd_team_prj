
#include <SoftwareSerial.h>

#define Tx_pin 8
#define Rx_pin 7
#define RS485_EN 2

SoftwareSerial RS485(Rx_pin, Tx_pin);

char rx_buf[20];
char tx_buf[20];
unsigned char rxd;
char rx_flag = 0;
int i = 0;

void serialEvent(){
  rxd = Serial.read();
  rx_flag = 1;
}

void setup() {
  // 송-수신, 485 Enable 핀 초기화 
  pinMode(Rx_pin, INPUT);
  pinMode(Tx_pin, OUTPUT);
  pinMode(RS485_EN, OUTPUT);
  digitalWrite(RS485_EN, 0); // 485 기본상태 = 수신

  // 소프트웨어, 하드웨어 Serial 통신 시작
  RS485.begin(9600);  // Software UART
  Serial.begin(115200); // Hardware UART
}

void loop() {

  // 시리얼통신 수신
  while(RS485.available()){
    rx_buf[i] = RS485.read();
    if(rx_buf[i] == '\n') {
      i = 0;
      Serial.print(rx_buf);
      break;
    }
    i++;
  }
  delay(400);
}
